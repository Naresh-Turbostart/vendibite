<!DOCTYPE html>
<html lang="en">
  <head>
        <script src="https://cdn.tailwindcss.com"></script>

    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />


    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <title>Lead Form</title>

    <style>
     body {
  font-family: "Inter", sans-serif;
  /* background: transparent;
  margin: 0;
  padding: 20px; */
}


      .custom-input {
        background: transparent;
        border: 1px solid rgba(75, 85, 99, 0.5);
        color: white;
      }
      .custom-input::placeholder {
        color: white;
      }
      .custom-input:focus {
        border-color: rgba(75, 85, 99, 0.5);
        box-shadow: none;
      }
      .iti { width: 100%; }
      .iti__flag-container { padding: 12px; }
      .iti__selected-flag { background: rgba(17, 24, 39, 0.8); border: 1px solid #030f0e; }
      .iti__country-list { background: #020202; border: 1px solid #020202; color: white; }
      .iti__country:hover { background: rgba(75, 85, 99, 0.3); }
      .iti input#phone { padding-left: 64px !important; }
      .iti input#phone::placeholder { text-indent: 0.5rem; }
      
    </style>
  </head>
  <body class="text-white xl:pt-7 lg:px-5 lg:pb-5 p-5">
    <form
      id="leadForm"
      action="https://webto.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8"
      method="POST"
      target="hidden_iframe"
      onsubmit="handleFormSubmit(event)"
      class="flex flex-col gap-y-4"
    >
      <!-- Your Salesforce Org ID -->
      <input type="hidden" name="oid" value="00D5j00000DCGyt" />

      <div class="grid grid-cols-2 gap-4">
        <div>
          <input
            type="text"
            name="first_name"
            placeholder="First Name"
            required
            class="w-full px-4 py-3 rounded custom-input focus:outline-none transition-all"
          />
        </div>
        <div>
          <input
            type="text"
            name="last_name"
            placeholder="Last Name"
            class="w-full px-4 py-3 rounded custom-input focus:outline-none transition-all"
          />
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="Email ID"
            class="w-full px-4 py-3 rounded custom-input focus:outline-none transition-all"
          />
          <p id="email-error" class="text-red-400 text-sm mt-1 hidden">
            Please enter a valid email.
          </p>
        </div>
        <div>
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            placeholder="Phone Number"
            class="w-full px-4 py-3 rounded custom-input focus:outline-none transition-all"
          />
        </div>
        <div>
          <button
            type="submit"
            class="w-full bg-[#BEFF4E] hover:bg-blue-700 text-black font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#4262FF] focus:ring-offset-2 focus:ring-offset-gray-900  cursor-pointer"
          >
            Send Now
          </button>
        </div>
      </div>
    </form>

    <iframe
      name="hidden_iframe"
      id="hidden_iframe"
      style="display: none"
      title="hidden_iframe"
    ></iframe>

    <script>
      let phoneInputInstance = null;

      function notifyParentOfSubmission(properties = {}) {
        const payload = {
          firstName: (properties.firstName || "").trim(),
          lastName: (properties.lastName || "").trim(),
          email: (properties.email || "").trim(),
          phone: (properties.phone || "").trim(),
          source: properties.source || "public/form.html",
        };

        const targetOrigin =
          typeof window !== "undefined" && window.location
            ? window.location.origin
            : "*";

        try {
          window.parent?.postMessage(
            { type: "leadFormSubmitted", payload },
            targetOrigin || "*"
          );
        } catch (error) {
          /* Swallow postMessage errors silently */
        }
      }

      // Basic email validator (conservative)
      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      // Show/hide email error (null-safe)
      function showEmailError(show) {
        const emailInput = document.getElementById("email");
        const errorMessage = document.getElementById("email-error");
        if (show) {
          emailInput?.classList.add("ring-2", "ring-red-500");
          errorMessage?.classList.remove("hidden");
        } else {
          emailInput?.classList.remove("ring-2", "ring-red-500");
          errorMessage?.classList.add("hidden");
        }
      }

      // Submit handler
      function handleFormSubmit(event) {
        event.preventDefault();

        const form = document.getElementById("leadForm");
        const emailInput = document.getElementById("email");
        const phoneElement = document.getElementById("phone");

        // Email validation
        const email = emailInput.value.trim();
        if (!validateEmail(email)) {
          showEmailError(true);
          emailInput.focus();
          return;
        }

        // Put full E.164 number in the input so SFDC receives it
        if (phoneInputInstance && phoneElement) {
          phoneElement.value = phoneInputInstance.getNumber();
        }

        const formData = new FormData(form);
        notifyParentOfSubmission({
          firstName: formData.get("first_name"),
          lastName: formData.get("last_name"),
          email: formData.get("email"),
          phone: formData.get("phone"),
        });

        // Submit to Salesforce in hidden iframe
        form.submit();

        // Reset UI immediately (no need to wait for iframe)
        form.reset();
        showEmailError(false);
        if (phoneInputInstance) phoneInputInstance.setNumber("");
        
        // Notify parent (optional)
        try { window.parent?.postMessage("formSubmitted", "*"); } catch (e) {}

        // Redirect to thank you page (works even if embedded)
        setTimeout(() => {
          const goto = "/thankpage";
          if (window.top && window.top !== window) {
            try { window.top.location.href = goto; return; } catch (e) {}
          }
          window.location.href = goto;
        }, 300);
      }

      // Init
      document.addEventListener("DOMContentLoaded", function () {
        const phoneInput = document.querySelector("#phone");
        const emailInput = document.getElementById("email");

        if (phoneInput) {
          // Numeric-only typing
          phoneInput.addEventListener("keypress", function (event) {
            const code = event.charCode;
            if (code && (code < 48 || code > 57)) event.preventDefault();
          });
          phoneInput.addEventListener("paste", function (event) {
            const t = event.clipboardData?.getData("text") ?? "";
            if (t && !/^\d+$/.test(t)) event.preventDefault();
          });

          // Initialize intl-tel-input
          phoneInputInstance = window.intlTelInput(phoneInput, {
           initialCountry: "auto",
geoIpLookup: function (callback) {
  fetch("https://ipapi.co/json")
    .then((res) => res.json())
    .then((data) => callback(data.country_code || "in"))
    .catch(() => callback("in")); // âœ… fallback to India
},

            utilsScript:
              "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
            separateDialCode: false,
            formatOnDisplay: true,
          });
        }

        if (emailInput) {
          emailInput.addEventListener("blur", function () {
            const v = this.value.trim();
            showEmailError(v && !validateEmail(v));
          });
          emailInput.addEventListener("input", function () {
            const v = this.value.trim();
            if (!v || validateEmail(v)) showEmailError(false);
          });
        }
      });

      // Optional: external reset hook
      window.addEventListener("message", function (event) {
        if (event.data === "resetForm") {
          const form = document.getElementById("leadForm");
          form.reset();
          showEmailError(false);
          if (phoneInputInstance) phoneInputInstance.setNumber("");
        }
      });
    </script>
  </body>
</html>
